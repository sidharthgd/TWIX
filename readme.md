# TWIX: Reconstructing Structured Data from Templatized Documents <!-- omit in toc -->

[![Paper](https://img.shields.io/badge/Paper-arXiv-red)](https://arxiv.org/abs/2501.06659)

- [üöÄ Getting Started](#-getting-started)
- [üì¶ Python Package](#-python-package)
- [üñ•Ô∏è User Interface](#Ô∏è-user-interface)
- [üìö TWIX API Reference](#-twix-api-reference)


TWIX is a tool for automatically extracting structured data from templatized documents that are programmatically generated by populating fields in a visual template.
TWIX infers the underlying template and then performs data extraction, offering a scalable solution with high accuracy and low cost. In particular, TWIX offers, 

1. A Python package for extracting structured data from documents step by step, designed for production pipeline deployment, with optional user feedback to monitor and refine the extraction process.
2. An interactive UI playground for data extraction that allows users to edit the inferred template, enabling more confident and accurate extraction.

![TWIX Figure](docs/assets/image/blog_example.png)



# üöÄ Getting Started

- Python 3.10 or later
- OpenAI API key

1. Clone the repository

```bash
git clone https://github.com/ucbepic/TWIX.git
```

2. Install packages. 

```bash
pip install -e . 
```

3. Set OpenAI API key as environment variable

[You can refer to this document](https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety)

# üì¶ Python Package 

If you want to use TWIX as a Python package, see detailed Python API references in  [TWIX API Reference](#twix-api-reference), and examples below. 

1. To use TWIX to extract structured data step by step, check out [`tests/test_twix.ipynb`](tests/test_twix.ipynb).
2. To use TWIX to extract structured data with a single API call, check out [`tests/test_twix_transform.ipynb`](tests/test_twix_transform.ipynb).
3. To edit the inferred template with user input, check out [`tests/test_twix_user_apis.ipynb`](tests/test_twix_user_apis.ipynb).

# üñ•Ô∏è User Interface

If you want to use TWIX in our user interfaces:  

1. Start the frontend server. In the `/twix-ui/` directory, run:

   ```bash
   npm start
   ```

2. Start the backend server. In the `/twix-ui/backend/` directory, run:

   ```bash
   python3 app.py
   ```
[Watch the TWIX Demo](docs/assets/video/Twix_Demo.mp4)
![TWIX Figure](docs/assets/image/UI.png)

# üìö TWIX API Reference

This document provides an overview of the available APIs in the TWIX Python package. Each API is described with its functionality, parameters, and return values.

---

## API List <!-- omit in toc -->

```python
__all__ = [
    "predict_field",
    "predict_template",
    "extract_data",
    "extract_phrase",
    "transform",
    "remove_template_node",
    "modify_template_node",
    "add_fields",
    "remove_fields"
]
```

Below is a detailed description of each API:

---

### 1. extract_phrase<!-- omit in toc -->

Extracts phrases from PDFs by using OCR tools.

- **Parameters:**
  - `data_files` (list): Stores a list of paths to documents that are created using the same template.
  - `result_folder` (str): The path to store results. 
  - `LLM_model_name` (str, optional): Specify the LLM model name.  
  - `page_to_infer_fields` (int, optional): TWIX extracts all phrases from each input document by default. For field prediction, it separately creates a small document sample by specifying `page_to_infer_fields` (by default is 5), which determines how many pages are used for inferring fields. 
- **Returns:**
  - `dict`: A dict of phrases per input document. The key in the dict stores the document name. The value corresponds to the raw extracted phrases and their bounding box, which are also written in the result folder.
  - `cost` (float): The cost incurred during the function call. 

---

### 2. predict_field<!-- omit in toc -->

Predicts a list of fields from documents. Fields refer to phrases in table headers or keywords in key-value pairs.

- **Parameters:**
  - `data_files` (list): Stores a list of paths to documents that are created using the same template.
  - `result_folder` (str): The path to store results. 
  - `LLM_model_name` (str, optional): Specify the LLM model name. 
- **Returns:**
  - `list`: A list of predicted phrases. TWIX also writes the results in the local result folder, naming the file as `twix_key.txt`.
  - `cost` (float): The cost incurred during the function call. 
---

### 3. predict_template<!-- omit in toc -->

Predicts the template from documents. A template is defined as a tree (refer to the paper for details) and stored as a JSON. Each tree node (JSON object) corresponds to the abstract of a data block, storing the type and fields of the node.

- **Parameters:**
  - `data_files` (list): Stores a list of paths to documents that are created using the same template.
  - `result_folder` (str): The path to store results. 
  - - `LLM_model_name` (str, optional): Specify the LLM model name. 
- **Returns:**
  - `list`: The template as a list of nodes, stored locally in the result folder, naming the file as `template.json`.
  - `cost` (float): The cost incurred during the function call. 
---

### 4. extract_data<!-- omit in toc -->

Extracts data based on a template.

- **Parameters:**
  - `data_files` (list): Stores a list of paths to documents that are created using the same template.
  - `template` (list, optional): The template output from `predict_template`. If not specified, TWIX will look in the local result folder to read the predicted template.
  - `result_folder` (str): The path to store results. 
- **Returns:**
  - `dict`: A dictionary of extraction results, where the key is the file path, and the value is the extraction object of that file. Each extraction object is a list of data blocks containing either table blocks or key-value blocks. Results will be written locally in the result folder, naming the file as `extracted.json`.
  - `cost` (float): The cost incurred during the function call. 
---

### 5. transform<!-- omit in toc -->

Provides an end-to-end API to directly extract data from PDFs.

- **Parameters:**
  - `data_files` (list): Stores a list of paths to documents that are created using the same template.
  - `result_folder` (str): The path to store results. 
- **Returns:**
  - `fields` (list): A list of strings representing the predicted fields.
  - `template` (list): The template as a list of nodes, stored locally in the result folder, naming the file as `template.json`.
  - `extraction_object` (dict): A dictionary of extraction results, where the key is the file path, and the value is the extraction object of that file. Each extraction object is a list of data blocks containing either table blocks or key-value blocks. Results will be written locally in the result folder, naming the file as `extracted.json`.
  - `cost` (float): The cost incurred during the function call. 
---

### 6. add_fields<!-- omit in toc -->

Allows users to add fields to the predicted fields.

- **Parameters:**
  - `added_fields` (list): A list of fields to add based on the predicted fields.
  - `result_folder` (str): The path to store results. 

---

### 7. remove_fields<!-- omit in toc -->

Allows users to delete fields from the predicted fields.

- **Parameters:**
  - `removed_fields` (list): A list of fields to delete based on the predicted fields.
  - `result_folder` (str): The path to store results. 

---

### 8. remove_template_node<!-- omit in toc -->

Allows users to remove nodes in the predicted template.

- **Parameters:**
  - `node_ids` (list): A list of node IDs. Each node ID is an integer.
  - `result_folder` (str): The path to store results. 

---

### 9. modify_template_node<!-- omit in toc -->

Allows users to update nodes in the predicted template.

- **Parameters:**
  - `node_id` (int): The integer node ID to update.
  - `type` (str): The type of the node to update, either `"kv"` or `"table"`.
  - `fields` (list): A list of fields (strings) to update.
  - `result_folder` (str): The path to store results. 




